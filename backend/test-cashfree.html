<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashfree Payment Gateway Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #ff6b6b;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        button {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .response {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            border-left: 4px solid #4CAF50;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .response.error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #1976D2;
        }
        
        .endpoints {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .endpoints h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .endpoint {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #ff6b6b;
        }
        
        .endpoint-method {
            font-weight: bold;
            color: #ff6b6b;
            margin-right: 10px;
        }
        
        .endpoint-url {
            font-family: 'Courier New', monospace;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ’³ Cashfree Payment Gateway</h1>
            <p>Test Interface for Payment Integration</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <h4>ðŸ“Œ Important Information</h4>
                <p><strong>Server URL:</strong> http://localhost:3004</p>
                <p><strong>Test Environment:</strong> Cashfree Sandbox</p>
                <p><strong>Status:</strong> Make sure your server is running and Cashfree credentials are configured</p>
            </div>
            
            <!-- Create Payment Order -->
            <div class="test-section">
                <h3>ðŸš€ Create Payment Order</h3>
                <div class="form-group">
                    <label for="amount">Amount (â‚¹):</label>
                    <input type="number" id="amount" placeholder="100.00" step="0.01" value="100.00">
                </div>
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" placeholder="John Doe" value="John Doe">
                </div>
                <div class="form-group">
                    <label for="customerEmail">Customer Email:</label>
                    <input type="email" id="customerEmail" placeholder="john@example.com" value="john@example.com">
                </div>
                <div class="form-group">
                    <label for="customerPhone">Customer Phone:</label>
                    <input type="tel" id="customerPhone" placeholder="9999999999" value="9999999999">
                </div>
                <div class="form-group">
                    <label for="returnUrl">Return URL (Optional):</label>
                    <input type="url" id="returnUrl" placeholder="http://localhost:3000/payment/success">
                </div>
                <button onclick="createPaymentOrder()">Create Payment Order</button>
                <div id="createOrderResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- Verify Payment -->
            <div class="test-section">
                <h3>âœ… Verify Payment</h3>
                <div class="form-group">
                    <label for="verifyOrderId">Order ID:</label>
                    <input type="text" id="verifyOrderId" placeholder="order_1234567890_abcdef">
                </div>
                <button onclick="verifyPayment()">Verify Payment</button>
                <div id="verifyPaymentResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- Get Order Status -->
            <div class="test-section">
                <h3>ðŸ“Š Get Order Status</h3>
                <div class="form-group">
                    <label for="statusOrderId">Order ID:</label>
                    <input type="text" id="statusOrderId" placeholder="order_1234567890_abcdef">
                </div>
                <button onclick="getOrderStatus()">Get Order Status</button>
                <div id="orderStatusResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- Refund Payment -->
            <div class="test-section">
                <h3>ðŸ’° Refund Payment</h3>
                <div class="form-group">
                    <label for="refundOrderId">Order ID:</label>
                    <input type="text" id="refundOrderId" placeholder="order_1234567890_abcdef">
                </div>
                <div class="form-group">
                    <label for="refundAmount">Refund Amount (â‚¹):</label>
                    <input type="number" id="refundAmount" placeholder="50.00" step="0.01">
                </div>
                <div class="form-group">
                    <label for="refundNote">Refund Note:</label>
                    <input type="text" id="refundNote" placeholder="Customer requested refund">
                </div>
                <button onclick="refundPayment()">Process Refund</button>
                <div id="refundResponse" class="response" style="display:none;"></div>
            </div>
            
            <!-- API Endpoints Reference -->
            <div class="endpoints">
                <h3>ðŸ“š Available API Endpoints</h3>
                <div class="endpoint">
                    <span class="endpoint-method">POST</span>
                    <span class="endpoint-url">/api/v1/cashfree/create-order</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">POST</span>
                    <span class="endpoint-url">/api/v1/cashfree/verify-payment</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">GET</span>
                    <span class="endpoint-url">/api/v1/cashfree/order-status/:orderId</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">GET</span>
                    <span class="endpoint-url">/api/v1/cashfree/payment-details/:orderId/:cfPaymentId</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">POST</span>
                    <span class="endpoint-url">/api/v1/cashfree/refund</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">GET</span>
                    <span class="endpoint-url">/api/v1/cashfree/refund-status/:orderId/:refundId</span>
                </div>
                <div class="endpoint">
                    <span class="endpoint-method">POST</span>
                    <span class="endpoint-url">/api/v1/cashfree/webhook</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3004/api/v1/cashfree';

        async function makeRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                const result = await response.json();
                return { success: response.ok, data: result };
            } catch (error) {
                return { success: false, data: { message: error.message } };
            }
        }

        function displayResponse(elementId, response) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${response.success ? '' : 'error'}`;
            element.textContent = JSON.stringify(response.data, null, 2);
        }

        async function createPaymentOrder() {
            const amount = document.getElementById('amount').value;
            const customerName = document.getElementById('customerName').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const returnUrl = document.getElementById('returnUrl').value;

            if (!amount || !customerName || !customerEmail || !customerPhone) {
                alert('Please fill in all required fields');
                return;
            }

            const data = {
                amount: amount,
                customer_name: customerName,
                customer_email: customerEmail,
                customer_phone: customerPhone,
                ...(returnUrl && { return_url: returnUrl })
            };

            const response = await makeRequest(`${API_BASE_URL}/create-order`, 'POST', data);
            displayResponse('createOrderResponse', response);

            // Auto-fill order ID for other forms if successful
            if (response.success && response.data.data) {
                const orderId = response.data.data.order_id;
                document.getElementById('verifyOrderId').value = orderId;
                document.getElementById('statusOrderId').value = orderId;
                document.getElementById('refundOrderId').value = orderId;
                
                // Show payment link if available
                if (response.data.data.payment_link) {
                    const paymentButton = document.createElement('button');
                    paymentButton.textContent = 'ðŸ’³ Complete Payment (Money will be deducted here)';
                    paymentButton.style.backgroundColor = '#28a745';
                    paymentButton.style.marginTop = '10px';
                    paymentButton.onclick = () => {
                        window.open(response.data.data.payment_link, '_blank');
                    };
                    document.getElementById('createOrderResponse').appendChild(paymentButton);
                    
                    // Add auto-redirect option
                    const autoRedirectBtn = document.createElement('button');
                    autoRedirectBtn.textContent = 'ðŸš€ Auto-Redirect to Payment (3 seconds)';
                    autoRedirectBtn.style.backgroundColor = '#007bff';
                    autoRedirectBtn.style.marginTop = '10px';
                    autoRedirectBtn.style.marginLeft = '10px';
                    autoRedirectBtn.onclick = () => {
                        let countdown = 3;
                        autoRedirectBtn.textContent = `Redirecting in ${countdown}...`;
                        const timer = setInterval(() => {
                            countdown--;
                            if (countdown > 0) {
                                autoRedirectBtn.textContent = `Redirecting in ${countdown}...`;
                            } else {
                                clearInterval(timer);
                                window.location.href = response.data.data.payment_link;
                            }
                        }, 1000);
                    };
                    document.getElementById('createOrderResponse').appendChild(autoRedirectBtn);
                }
            }
        }

        async function verifyPayment() {
            const orderId = document.getElementById('verifyOrderId').value;

            if (!orderId) {
                alert('Please enter Order ID');
                return;
            }

            const data = { orderId: orderId };
            const response = await makeRequest(`${API_BASE_URL}/verify-payment`, 'POST', data);
            displayResponse('verifyPaymentResponse', response);
        }

        async function getOrderStatus() {
            const orderId = document.getElementById('statusOrderId').value;

            if (!orderId) {
                alert('Please enter Order ID');
                return;
            }

            const response = await makeRequest(`${API_BASE_URL}/order-status/${orderId}`);
            displayResponse('orderStatusResponse', response);
        }

        async function refundPayment() {
            const orderId = document.getElementById('refundOrderId').value;
            const refundAmount = document.getElementById('refundAmount').value;
            const refundNote = document.getElementById('refundNote').value;

            if (!orderId || !refundAmount) {
                alert('Please enter Order ID and Refund Amount');
                return;
            }

            const data = {
                orderId: orderId,
                refundAmount: refundAmount,
                refundNote: refundNote || 'Refund processed'
            };

            const response = await makeRequest(`${API_BASE_URL}/refund`, 'POST', data);
            displayResponse('refundResponse', response);
        }

        // Auto-fill test data
        window.onload = function() {
            console.log('Cashfree Payment Gateway Test Interface Loaded');
            console.log('Make sure your server is running on http://localhost:3004');
        };
    </script>
</body>
</html>
